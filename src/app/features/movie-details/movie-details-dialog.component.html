<div class="movie-details-dialog-container">
  @if (isLoading()) {
    <div class="loading">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
  }

  @if (!isLoading() && movieDetails()) {
    <div class="movie-details">
      <div class="movie-header">
        <div class="poster-section">
          @if (movieDetails()?.poster_path) {
            <img [src]="getImageUrl(movieDetails()?.poster_path)" [alt]="movieDetails()?.title" class="poster" />
          }
          @if (!movieDetails()?.poster_path) {
            <div class="no-poster">Sem imagem</div>
          }
        </div>

        <div class="info-section">
          <h2>{{ movieDetails()?.title }}</h2>
          <p class="release-date">Lançamento: {{ movieDetails()?.release_date | date: 'dd/MM/yyyy' }}</p>
          @if (movieDetails()!.runtime > 0) {
            <p class="runtime">Duração: {{ movieDetails()?.runtime }} minutos</p>
          }

          <div class="rating">
            <span class="vote-average">⭐ {{ movieDetails()!.vote_average.toFixed(1) }}/10</span>
            <span class="vote-count">({{ movieDetails()?.vote_count }} votos)</span>
          </div>
        </div>
      </div>

      <div class="movie-details-body">
        <h3>Sinopse</h3>
        <p>{{ movieDetails()?.overview }}</p>

        <h3>Informações Adicionais</h3>
        <p>Orçamento: {{ formatCurrency(movieDetails()?.budget) }}</p>
        <p>Receita: {{ formatCurrency(movieDetails()?.revenue) }}</p>
        <p>Idiomas: {{ getLanguagesText() }}</p>

        <div class="rating-section">
          <h3>Sua Avaliação</h3>
          
          @if (ratingSubmitted()) {
            <div class="rating-success">
              ✓ Avaliação enviada com sucesso!
            </div>
          }

          @if (ratingError()) {
            <div class="rating-error">
              {{ ratingError() }}
            </div>
          }

          @if (!ratingSubmitted()) {
            <div class="rating-stars-container">
              <div class="stars-wrapper">
                @for (star of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; track star) {
                  <button
                    type="button"
                    mat-icon-button
                    class="star-btn"
                    [class.filled]="userRating() >= star"
                    (click)="setRating(star)"
                    [disabled]="isSubmittingRating()"
                  >
                    <mat-icon>
                      {{ userRating() >= star ? 'star' : 'star_outline' }}
                    </mat-icon>
                  </button>
                }
              </div>
              
              <div class="rating-value">
                {{ userRating() > 0 ? userRating() + '/10' : 'Selecione uma nota' }}
              </div>
            </div>
            
            <button 
              mat-raised-button 
              color="primary"
              (click)="submitRating()"
              [disabled]="isSubmittingRating() || userRating() <= 0"
              class="submit-rating-btn"
            >
              @if (isSubmittingRating()) {
                <mat-spinner diameter="20" strokeWidth="2"></mat-spinner>
                Enviando...
              } @else {
                Enviar Avaliação
              }
            </button>
          }
        </div>
      </div>

      <div class="dialog-actions">
        <button mat-button (click)="closeDialog()">Fechar</button>
      </div>
    </div>
  }
</div>
