<div class="movie-details-dialog-container">
  @if (isLoading()) {
    <div class="loading">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
  }

  @if (!isLoading() && movieDetails()) {
    <div class="movie-details">
      <div class="movie-header">
        <div class="poster-section">
          @if (movieDetails()?.poster_path) {
            <img [src]="getImageUrl(movieDetails()?.poster_path)" [alt]="movieDetails()?.title" class="poster" />
          }
          @if (!movieDetails()?.poster_path) {
            <div class="no-poster">Sem imagem</div>
          }
        </div>

        <div class="info-section">
          <h2>{{ movieDetails()?.title }}</h2>
          <p class="release-date">Lançamento: {{ movieDetails()?.release_date | date: 'dd/MM/yyyy' }}</p>
          @if (movieDetails()!.runtime > 0) {
            <p class="runtime">Duração: {{ movieDetails()?.runtime }} minutos</p>
          }

          <div class="rating">
            <span class="vote-average">⭐ {{ movieDetails()!.vote_average.toFixed(1) }}/10</span>
            <span class="vote-count">({{ movieDetails()?.vote_count }} votos)</span>
          </div>
        </div>
      </div>

      <div class="movie-details-body">
        <h3>Sinopse</h3>
        <p>{{ movieDetails()?.overview }}</p>

        <h3>Informações Adicionais</h3>
        <p>Orçamento: {{ formatCurrency(movieDetails()?.budget) }}</p>
        <p>Receita: {{ formatCurrency(movieDetails()?.revenue) }}</p>
        <p>Idiomas: {{ getLanguagesText() }}</p>

        <div class="rating-section">
          <h3>Sua Avaliação</h3>
          
          @if (ratingSubmitted()) {
            <div class="rating-success">
              ✓ Avaliação enviada com sucesso!
            </div>
          }

          @if (ratingError()) {
            <div class="rating-error">
              {{ ratingError() }}
            </div>
          }

          @if (!ratingSubmitted()) {
            <div class="rating-input">
              <mat-form-field appearance="outline" class="rating-slider-field">
                <mat-label>Sua nota (0.5 a 10)</mat-label>
                <input 
                  matInput 
                  type="number" 
                  [ngModel]="userRating()"
                  (ngModelChange)="userRating.set($event)"
                  [disabled]="isSubmittingRating()"
                  min="0.5" 
                  max="10" 
                  step="0.5"
                  placeholder="Digite uma nota de 0.5 a 10"
                />
              </mat-form-field>
              
              <button 
                mat-raised-button 
                color="primary"
                (click)="submitRating()"
                [disabled]="isSubmittingRating() || userRating() <= 0"
              >
                @if (isSubmittingRating()) {
                  <mat-spinner diameter="20" strokeWidth="2"></mat-spinner>
                  Enviando...
                } @else {
                  Enviar Avaliação
                }
              </button>
            </div>
          }
        </div>
      </div>

      <div class="dialog-actions">
        <button mat-button (click)="closeDialog()">Fechar</button>
      </div>
    </div>
  }
</div>
